<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<!-- Fees Concession Form -->
		<record id="pappaya_fees_concession_form" model="ir.ui.view">
			<field name="name">pappaya.fees.concession.form</field>
			<field name="model">pappaya.fees.concession</field>
			<field name="arch" type="xml">
				<form string="Fees Concession" duplicate="0">
				        <header>
					    <button name="confirm_request" states="draft" string="Concesion request"
                                             type="object" class="oe_highlight" groups="pappaya_core.group_pappaya_school_level_officer,pappaya_core.group_pappaya_school_level_fin_admin,pappaya_core.group_pappaya_national_level_fin_admin,pappaya_core.group_pappaya_national_level_officer,pappaya_core.group_pappaya_national_level_it_admin"/>
					     <button name="confirm_approved" states="requested" string="Approve"
                                             type="object" class="oe_highlight" groups="pappaya_core.group_pappaya_national_level_officer,pappaya_core.group_pappaya_national_level_it_admin,pappaya_core.group_pappaya_national_level_fin_admin,pappaya_core.group_pappaya_state_level_officer,pappaya_core.group_pappaya_state_level_fin_admin"/>
					     <button name="concession" states="approved" string="Apply Now"  
					     type="object" class="oe_highlight" groups="pappaya_core.group_pappaya_national_level_officer,pappaya_core.group_pappaya_national_level_it_admin,pappaya_core.group_pappaya_national_level_fin_admin,pappaya_core.group_pappaya_state_level_officer,pappaya_core.group_pappaya_state_level_fin_admin,pappaya_core.group_pappaya_school_level_officer,pappaya_core.group_pappaya_school_level_fin_admin"/>
					     <button name="confirm_cancelled" states="applied" string="Cancel"
                                             type="object" confirm="Are you sure you want to cancel?"  class="oe_highlight" groups="pappaya_core.group_pappaya_national_level_officer,pappaya_core.group_pappaya_national_level_it_admin,pappaya_core.group_pappaya_national_level_fin_admin,pappaya_core.group_pappaya_state_level_officer,pappaya_core.group_pappaya_state_level_fin_admin,pappaya_core.group_pappaya_school_level_officer,pappaya_core.group_pappaya_school_level_fin_admin"/>
					     <button name="confirm_rejected" states="requested" string="Reject"
                                             type="object" class="oe_highlight" groups="pappaya_core.group_pappaya_national_level_officer,pappaya_core.group_pappaya_national_level_it_admin,pappaya_core.group_pappaya_national_level_fin_admin,pappaya_core.group_pappaya_state_level_officer,pappaya_core.group_pappaya_state_level_fin_admin"/>
					     <field name="state" widget="statusbar" statusbar_visible="draft,requested,approved,applied,cancelled,rejected"/>
					</header>
					<sheet>
						<group col="4" colspan="2">
							<field name="society_id" options="{'no_open': True,'no_create':True}" domain="[('type','=','society')]" required="1" attrs="{'readonly':[('state','not in',['draft'])]}"  class="asterik"/>
							<field name="school_id" options="{'no_open': True,'no_create':True}" domain="[('type','=','school'),('parent_id','=',society_id)]" required="1"  attrs="{'readonly':[('state','not in',['draft'])]}" class="asterik"/>
							<field name="academic_year_id" domain="[('school_id', '=', school_id)]" options="{'no_open': True,'no_create':True}" required="1" attrs="{'readonly':[('state','not in',['draft'])]}" class="asterik"/>
							<field name="grade_id" options="{'no_open': True,'no_create':True}" attrs="{'readonly':[('state','not in',['draft'])]}" required="1" class="asterik"/>
							<field name="concession_type_id" class="asterik" options="{'no_open': True,'no_create':True}" attrs="{'readonly':[('state','not in',['draft'])]}" domain="[('school_ids', 'in', school_id)]"/>
							<field name="student_id" placeholder="Student Name" attrs="{'readonly':[('state','not in',['draft'])]}" options="{'no_open': True,'no_create':True}" class="asterik"/>
							<field name="enquiry_mode" nolabel="1"  options="{'horizontal': true}"  
					                 style="font-size: 20px !important; color: red !important; padding-bottom:18px;" colspan="2" readonly="1"/>
					        <field name="rte_fee_exempted" readonly="1" attrs="{'invisible':[('enquiry_mode','=','normal')]}"/>
							<field name="enrollment_number" style="font-size: 15px !important;color: black !important; padding-bottom:18px;" readonly="1"/>
							<field name="concession_applied_now" invisible="1"/>
							<field name="concession_code" invisible="1"/>
						</group>
						<group col="4" colspan="2">
							<field name="concession_head_line" nolabel="1" attrs="{'readonly':[('state','in',['approved','applied','cancelled','rejected'])]}">
								<tree string ="Fees Head" editable="bottom" create="false" delete="false" open="false">
											<field name="name" readonly="1"/>
											<field name="amount" readonly="1"/>
											<field name="fee_due_amount" readonly="1"/>
											<field name="concession_applied" readonly="1"/>
											<field name="discount_method" attrs="{'readonly':[('readonly_state','=','done')]}"/>
											<field name="discount_amount" widget="char" attrs="{'readonly':['|',('discount_method','=',False),('readonly_state','=','done')]}"/>
											<field name="total_amount" readonly="1"/>
											<field name="fee_term_state" readonly="1"/>
											<field name="readonly_state" invisible="1"/>
											
										</tree>
								<form string ="Fees Head">
									<group col="2" colspan="2">
										<field name="name" readonly="1"/>
										<field name="term_divide" readonly="1"/>
										<field name="amount" readonly="1"/>
										<field name="fee_due_amount" readonly="1"/>
										<field name="discount_method" attrs="{'readonly':[('readonly_state','=','done')]}"/>
										<field name="discount_amount" widget="char" attrs="{'readonly':['|',('discount_method','=',False),('readonly_state','=','done')]}"/>
										<field name="total_amount" readonly="1"/>
										<field name="fee_term_state" readonly="1"/>
										<field name="readonly_state" invisible="1"/>
									</group>
								</form>
							</field>
						</group>
							<notebook>
								<page string="Siblings Details" attrs="{'invisible':[('concession_code','not in', 'SIBCON')]}">
									<group col="4">
										<field name="siblings_line" nolabel="1" widget="one2many_list" readonly="1">
			                                <tree editable="bottom" string="Siblings Details">
												<field name="enq_enroll" />
												<field name="sibling_name" />
												<field name="sibling_class" />
												<field name="dob" />
												<field name="father_name" />
						                        <field name="enquiry_id" options='{"no_open": True, "no_create": True}' invisible="1"/>
					                        </tree>
					                        <form>
					                        	<group col="2" colspan="2">
							                        <field name="enq_enroll" />
													<field name="sibling_name" />
													<field name="sibling_class" />
													<field name="dob" />
													<field name="father_name" />
							                        <field name="enquiry_id" options='{"no_open": True, "no_create": True}' invisible="1"/>
					                        	</group>
					                        </form>
			                            </field>
			                        </group>
			                    </page>
			                    
			                    <page string="Staff Details" attrs="{'invisible':[('concession_code','not in', 'STFCON')]}">
									<group col="4">
										<field name="staff_line" nolabel="1" widget="one2many_list" readonly="1">
			                                <tree string="Staff">
							                    <field name="full_name" />
							                    <field name="staff_code" />
							                    <field name="category" />
							                </tree>
					                        <form>
					                        	<group col="2" colspan="2">
							                        <field name="full_name" />
								                    <field name="shift" />
								                    <field name="staff_code" />
								                    <field name="category" />
								                    <field name="date_of_joining" />
								                    <field name="religion" />
								                    <field name="blood_group" />
					                        	</group>
					                        </form>
			                            </field>
			                        </group>
			                    </page>
			                    
							</notebook>					
						
						<group col="8" colspan="4">
                                                   <field name="total" invisible="1"/>
                                               </group>
						<group col="4" colspan="2">
						    <field name="reason" attrs="{'required':[('state','=','cancelled')],'invisible':[('state','not in',['applied','cancelled'])]}"/>
						</group>
					</sheet>
					<footer>
<!--
							<div class="text-center">
								<button name="concession" string="Apply Now"  type="object" class="oe_highlight" 
								attrs="{'invisible':['|',('state','!=','approved'),('concession_applied_now','!=',False)]}"/>
							</div>
-->
					</footer>
				</form>
			</field>
		</record>
		<!-- Fees Concession Tree -->
		
		<record id="pappaya_fees_concession_tree" model="ir.ui.view">
			<field name="name">pappaya.fees.concession.tree</field>
			<field name="model">pappaya.fees.concession</field>
			<field name="arch" type="xml">
				<tree string="Fees Concession">
					<field name="society_id" />
					<field name="school_id"/>
					<field name="academic_year_id"/>
					<field name="grade_id"/>
					<field name="student_id"/>
					<field name="concession_type_id"/>
					<field name="state"/>
				</tree>
			</field>
		</record>
		
		
		<record id="pappaya_fees_concession_search" model="ir.ui.view">
            <field name="name">pappaya_fees_concession_search</field>
            <field name="model">pappaya.fees.concession</field>
            <field name="priority" eval="8" />
            <field name="arch" type="xml">
                <search string="Enquiry">
                    <field name="society_id" />
					<field name="school_id"/>
					<field name="academic_year_id"/>
					<field name="grade_id"/>
					<field name="student_id"/>
					<field name="state"/>
                    <newline />
					<group expand="0" string="Group By...">
                        <filter string="Society" domain="[]" context="{'group_by':'society_id'}" />
						<filter string="School" domain="[]" context="{'group_by':'school_id'}" />
						<filter string="Academic Year" domain="[]" context="{'group_by':'academic_year_id'}"/>
						<filter string="Class" domain="[]" context="{'group_by':'grade_id'}"/>
						<filter string="Status" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>
		
		
		
		<record model="ir.actions.act_window" id="action_pappaya_fees_concession_id">
			<field name="name">Fees Management > Configuration > Fees Concession</field>
			<field name="res_model">pappaya.fees.concession</field>
			<field name="view_mode">tree,form</field>
		</record>
		
	</data>
</odoo>
